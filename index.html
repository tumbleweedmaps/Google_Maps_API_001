<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Google Maps API</title>
  <style>
    #map-wrapper {
      width: 100%;
      /* background: black; */
      padding: 20px;
    }

    #map {
      height: 700px;
      width: 100%;
      margin: auto;
    }
  </style>
</head>
<body>


<script type="module">
  import { auth } from './firebase.js';
  import {
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword
  } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';
import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';

onAuthStateChanged(auth, (user) => {
  if (user) {
    console.log(`‚úÖ Logged in as: ${user.email}`);
    document.body.insertAdjacentHTML('beforeend', `<p>Welcome, ${user.email}</p>`);
  } else {
    console.log('‚ùå No user logged in');
  }
});

  // Expose functions globally
  window.signUp = async function () {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    try {
      await createUserWithEmailAndPassword(auth, email, pass);
      alert('‚úÖ Account created!');
    } catch (e) {
      alert(`‚ùå ${e.message}`);
    }
  };

  window.login = async function () {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      alert('‚úÖ Logged in!');
    } catch (e) {
      alert(`‚ùå ${e.message}`);
    }
  };
  import { signOut } from 'https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js';

window.logout = async function () {
  try {
    await signOut(auth);
    alert('üëã Logged out!');
  } catch (e) {
    alert(`‚ùå ${e.message}`);
  }
};

window.handleClimbAnswer = async function (hasClimbed) {
  const user = auth.currentUser;
  if (!user) {
    alert("‚ùå You must be logged in to submit.");
    return;
  }

  try {
    await setDoc(doc(db, "userClimbs", user.uid), {
      climbedWashington: hasClimbed
    }, { merge: true }); // merge = don't overwrite other fields
    alert(`‚úÖ Response recorded: ${hasClimbed ? "Yes" : "No"}`);
  } catch (e) {
    console.error("‚ùå Error saving to Firestore:", e);
    alert("Something went wrong saving your answer.");
  }
};

</script>

      <h2>Login</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="signUp()">Sign Up</button>
  <button onclick="login()">Login</button>
  <button onclick="logout()">Logout</button>
  <div id="map-wrapper">
    <div id="map"></div>
  </div>

  <!-- Add Modules -->
<script src="modules/clickToAddMarker.js"></script>
<script src="modules/addKMLLayer.js"></script>

  <script>
    function initMap() {
      const noLabelsStyle = [
        {
          featureType: "all",
          elementType: "labels",
          stylers: [{ visibility: "off" }],
        },
        {
          featureType: "road",
          elementType: "geometry",
          stylers: [{ visibility: "on" }],
        },
      ];

      const center = { lat: 44.27049, lng: -71.30327 };

      const map = new google.maps.Map(document.getElementById("map"), {
        center: center,
        zoom: 12,
        heading: 0,
        tilt: 45,
        mapTypeId: "terrain",
        mapId: "60dbabc0c2aa1d3b6de10662", // Make sure this is configured in your Google Cloud Console
        styles: noLabelsStyle,
      });

      const marker = new google.maps.Marker({
        position: center,
        map: map,
        title: "My Location",
      });

      const infoWindow = new google.maps.InfoWindow({
        content: "<b>You're here!</b>",
      });

      // const kmlLayer = new google.maps.KmlLayer({
      //   url: 'https://storage.googleapis.com/tumbleweed_kml/newIconsD.kml',
      //   map: map,
      // });



    //   Add Function Calls
      // enableClickToAddMarker(map);
      // addKmlLayer(map, "https://tumbleweedmaps.github.io/Google_Maps_API_001/kml/KML_aga4.kml")
      // addKmlLayer(map, "https://tumbleweedmaps.github.io/Google_Maps_API_001/kml/KML_ct_trains.kml")
      addKmlLayer(map, "https://tumbleweedmaps.github.io/Google_Maps_API_001/peaks/kml_mount_washington.kml")
      addKmlLayer(map, "https://tumbleweedmaps.github.io/Google_Maps_API_001/peaks/kml_mount_adams.kml")
      addKmlLayer(map, "https://tumbleweedmaps.github.io/Google_Maps_API_001/peaks/kml_mount_jefferson.kml")

      
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5ul6nx5THZfVhGtlCwuRQJy80MLn1beo&callback=initMap">
  </script>

  
</body>
</html>
